---
title: "Lab 5"
output: html_notebook
---
### Q1 ###
```{r}
## simulation example
ITER = 10000
nn = 30

t.stats <- pt.vec <- pz.vec <-rep(0,ITER)
for (i in 1:ITER) {
  xx = rnorm(nn, 160,20)
  xbar = mean(xx)
  S = sd(xx)
  t.stats[i] =(xbar-160)/(S/sqrt(nn))
  pt.vec[i] = pt(t.stats[i],nn-1, lower.tail=F)
  pz.vec[i] = pnorm(t.stats[i],lower.tail = F)
  }
head(t.stats)
#error rate
sum(pt.vec < 0.05)/ITER
sum(pz.vec < 0.05)/ITER

## Note that line 20 is too high!

### Sampling distribution of your test statistic:
hist(t.stats)
```
#### Q2 ####
```{R}


# What do you need to change above?
```
#### Q3 ####
```{R}
h0 = 0

ITER = 10000

n = 100
K = 5

# Bonferroni
pmat = matrix(NA, nrow = ITER, ncol = K)

for(i in 1:ITER){
  xmat = matrix(rnorm(K*n, 0,1), nrow = n, ncol = K) ## how much data do you need? 
  TS = colMeans(xmat)/(1/sqrt(n))
  pmat[i,] = pnorm(TS, lower.tail = F)
}

head(pmat)
### Family-wise error rate = 1 - (1-0.05)^K
# K = 5, this = 0.226
# K = 10, this = 0.401

## The multiple testing issue: Calculate the false discovery rate
mean(rowSums(pmat < 0.05) >= 1)

## The Bonferroni Correction factor
# Adjust the line above to apply the Bonferonni Correction factor

## Benjamini Hochberg
newp = apply(pmat, 1, p.adjust, method = "BH")
# Insert a line here to calculate the false discovery rate

###

# Now change K to 100 (you can try K = 50 if your computer is slow)

```

